{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Views Work plugin for Craft CMS 3.x
 *
 * Views Work Settings.twig
 *
 * @author    24hoursmedia
 * @copyright Copyright (c) 2018 24hoursmedia
 * @link      http://www.24hoursmedia.com
 * @package   ViewsWork
 * @since     1.0.0
 */
#}

{% import "_includes/forms" as forms %}
{% import 'views-work/_macros.twig' as vcp %}

{% do view.registerAssetBundle("twentyfourhoursmedia\\viewswork\\assetbundles\\viewswork\\ViewsWorkAsset") %}


<h3>Secrets</h3>

<p>
    {{ vcp.t('Views Work and its addons requires some secrets. You can just click save to save them with self-generated values.') }}
</p>
<div class="vw-grid vw-grid-cols-2 vw-gap-5">
    <div>
        {{ forms.textField({
            label: 'Signing key',
            instructions: 'Enter a secret key here for protecting registration urls.' | t('views-work'),
            id: 'signKey',
            name: 'signKey',
            value: settings['signKey']}) }}
    </div>
    <div>
        {{ forms.textField({
            label:'Reset URL Secret',
            instructions: 'Enter a secret for url resetting here. Or use the default autogenerated one.' | t('views-work'),
            id: 'urlResetSecret',
            name: 'urlResetSecret',
            value: settings['urlResetSecret']}) }}
    </div>
    <div>
        {{ forms.textField({
            label:'Block by queryParam secret',
            instructions: 'A secret that allows to block view registrations by including ?_vw_block=VALUE in the url' | t('views-work'),
            id: 'blockByQueryParamSecret',
            name: 'blockByQueryParamSecret',
            value: settings['blockByQueryParamSecret']})
        }}
    </div>
    <div>
        {{ forms.textField({
            label:'Block by cookie secret',
            instructions: 'A secret that allows to block view registrations with a cookie' | t('views-work'),
            id: 'blockByCookieSecret',
            name: 'blockByCookieSecret',
            value: settings['blockByCookieSecret']})
        }}
    </div>
</div>




<hr/>

<h3>Resetting views</h3>


<div class="row">
    <div class="col-5">
        <p>{{ 'You can reset the daily, weekly and hourly views with a special url or through a cron job.' | t('views-work') }}</p>
        <p>{{ 'If your server does not support cron jobs, you can use an external service to call the secret url (typically once every night some minutes after midnight).' | t('views-work') }}</p>
        <p>
            <em>
                {{ 'A service that can execute crons through urls can be found at:' }}
                <a href="https://www.easycron.com" rel="noopener noreferrer" target="_blank">www.easycron.com</a>.
                {{ 'Note that the url request needs to be a POST request.' }}
            </em>
        </p>

        {% if not settings.allowUrlReset %}
            <p>{{ 'After enabling \'resetting views through a secret url\', you can view the secret urls here.' }}</p>
        {% endif %}
    </div>
    <div class="col col-2"></div>
    <div class="col-5">
        {{ forms.lightswitch({
            label: 'Allow resetting views through a secret url',
            id: 'allowUrlReset',
            name: 'allowUrlReset',
            on: settings['allowUrlReset'],
            value: 1
        }) }}
        {{ forms.lightswitch({
            label: 'Allow GET requests to the url (normally only POST allowed)',
            id: 'allowUrlResetGET',
            name: 'allowUrlResetGET',
            on: settings['allowUrlResetGET'],
            value: 1
        }) }}
    </div>
</div>
{% if settings.allowUrlReset %}
    <div class="row">
        <div class="col-12">
            <br/>
            <p>The secret url to reset daily, weekly and monthly views is:</p>
            <p><strong>
                {{ settings.allowUrlResetGET ? 'GET or POST' : 'POST' }}<br/>
                    <small>

                        {{ siteUrl('actions/views-work/reset/reset', {key: settings.urlResetSecret}) }}
                    </small>
                </strong></p>
        </div>
    </div>
{% endif %}

<br/><br/>
<strong>CRON JOB</strong>
<p>
    In order to reset the daily, monthly and weekly view with a cron job,
    you should execute the command bellow to run every night, for example at 00:05.
</p>

The command to execute:

<br/><br/>
<code>
    php /path_to_project/craft views-work/default/reset-views
</code>
<br/><br/>

Example of a line in crontab file:
<br/><br/>
<code>
    5 0 * * * php /path_to_project/craft views-work/default/reset-views
</code>
<br/><br/>

<hr/>

{#
<h3>{{ vcp.t('Experimental') }}</h3>

<p>{{ vcp.t('Enabling experimental features may give you early access to the following features:') }}</p>

<ul class="vw-mt-2 vw-mb-2">
    <li>- {{ vcp.t('Sorting entries by popularity in the content section of the Craft control panel') }}</li>
</ul>

{{ forms.lightswitch({
    label: 'Enable experimental features',
    id: 'enableExperimentalFeatures',
    name: 'enableExperimentalFeatures',
    on: settings['enableExperimentalFeatures'],
    value: 1
}) }}
#}




